# A股日内交易分析系统

这是一个基于大模型（Qwen-Long/DeepSeek）的A股日内交易实时分析系统，可以帮助您获取股票实时数据并获得专业的交易建议。

## 📋 功能特点

- ✅ **实时行情获取**：获取股票的实时价格、涨跌幅、成交量等关键数据
- ✅ **技术指标分析**：自动计算EMA、MACD、RSI、KDJ、BOLL等常用技术指标
- ✅ **盘口数据**：获取五档买卖盘数据，分析买卖力量对比
- ✅ **大盘联动**：获取相关指数走势，评估系统性风险
- ✅ **板块分析**：了解股票所属板块的强弱和联动效应
- ✅ **市场情绪**：统计涨跌停家数、涨跌比等市场情绪指标
- ✅ **AI分析建议**：通过大模型给出具体的买卖建议、价位、止损止盈位
- ✅ **结果保存**：自动保存分析结果为JSON和Markdown格式

## 📁 文件结构

```
market_stratery/
├── intraday_trading_main.py          # 主程序入口
├── intraday_data_fetcher.py          # 数据获取模块
├── intraday_indicators.py            # 技术指标计算模块
├── intraday_prompt_builder.py        # 提示词构建模块
├── intraday_trading_config.json      # 配置文件
├── a_stock_trading_prompt_template.txt  # 提示词模板
├── keys.json                         # API密钥配置（需自行创建）
└── intraday_output/                  # 输出目录（自动创建）
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install akshare pandas numpy openai
```

### 2. 配置API密钥

在项目根目录创建 `keys.json` 文件（如果还没有的话）：

```json
{
  "api_key": "您的API密钥",
  "email_sender": "your_email@example.com",
  "email_password": "您的邮箱密码",
  "email_receivers": ["receiver@example.com"]
}
```

**获取API密钥：**
- Qwen API：访问 [阿里云百炼](https://dashscope.aliyuncs.com/) 获取
- DeepSeek API：访问 [DeepSeek开放平台](https://platform.deepseek.com/) 获取

### 3. 配置系统参数（可选）

编辑 `intraday_trading_config.json`：

```json
{
  "api_provider": "qwen",          // 可选 "qwen" 或 "deepseek"
  "data_config": {
    "intraday_minutes": 5,         // 分时数据采样间隔
    "history_days": 3,             // 历史分时数据天数
    "kline_days": 20,              // K线数据天数
    "cache_enabled": true          // 是否启用数据缓存
  },
  "risk_control": {
    "max_position_pct": 30,        // 最大持仓比例
    "stop_loss_pct": -3,           // 止损比例
    "take_profit_pct": 8           // 止盈比例
  },
  "output_config": {
    "save_to_file": true,          // 是否保存到文件
    "output_dir": "intraday_output", // 输出目录
    "show_realtime": true          // 是否实时显示结果
  }
}
```

### 4. 运行分析

#### 分析单只股票：

```bash
python intraday_trading_main.py 600000
```

#### 分析多只股票：

```bash
python intraday_trading_main.py 600000 000001 300750
```

## 💡 使用示例

### 示例1：分析平安银行（000001）

```bash
python intraday_trading_main.py 000001
```

**输出示例：**

```
============================================================
🚀 A股日内交易分析系统
============================================================

============================================================
开始分析股票: 000001
分析时间: 2025-10-24 10:30:15
============================================================

📊 步骤1: 获取股票数据...
  - 获取实时行情...
  ✅ 实时行情获取成功: 平安银行 当前价 12.35
  - 获取今日分时数据...
  ✅ 分时数据获取成功，共 120 条记录
  ...

📝 步骤2: 构建分析提示词...
  ✅ 提示词已保存: intraday_output/000001_平安银行_prompt_20251024_103015.txt

🤖 步骤3: 调用大模型进行分析...
  - 使用模型: qwen-long
  - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1

============================================================
💬 大模型分析结果：
============================================================

# 平安银行(000001) 交易分析

## 1. 技术面分析
当前价格12.35元，处于日内上升趋势...
[详细分析内容]

## 5. 交易决策

📊 **操作方向**：买入

💰 **建议价位**：
- 买入价格区间：12.30-12.40元

🎯 **仓位管理**：轻仓试探（20-30%）

🛡️ **风险控制**：
- 止损位：12.00元（-2.8%）
- 止盈位：12.90元（+4.5%）

...

============================================================

💾 步骤4: 保存分析结果...
  ✅ 分析结果(JSON)已保存: intraday_output/000001_平安银行_result_20251024_103520.json
  ✅ 分析报告(Markdown)已保存: intraday_output/000001_平安银行_analysis_20251024_103520.md

============================================================
📊 平安银行(000001) 分析完成
============================================================
分析时间: 2025-10-24 10:35:20
当前价格: 12.35 元
涨跌幅: 1.23%
============================================================
```

### 示例2：批量分析科技股

```bash
python intraday_trading_main.py 600050 300750 688981
```

系统会依次分析每只股票，并在股票之间等待5秒以避免请求过快。

## 📊 输出文件说明

分析完成后，会在 `intraday_output/` 目录下生成以下文件：

### 1. 提示词文件（`*_prompt_*.txt`）
保存发送给大模型的完整提示词，包含所有获取的数据。

### 2. 分析结果JSON（`*_result_*.json`）
```json
{
  "stock_code": "000001",
  "stock_name": "平安银行",
  "analysis_time": "2025-10-24 10:35:20",
  "current_price": 12.35,
  "price_change": 1.23,
  "analysis": "大模型的完整分析内容...",
  "prompt": "发送给大模型的提示词..."
}
```

### 3. 分析报告Markdown（`*_analysis_*.md`）
格式化的分析报告，方便阅读和分享。

## 🔧 高级配置

### 切换到DeepSeek模型

编辑 `intraday_trading_config.json`：

```json
{
  "api_provider": "deepseek",
  ...
}
```

然后在 `keys.json` 中配置DeepSeek的API密钥。

### 自定义提示词模板

修改 `a_stock_trading_prompt_template.txt` 文件，调整分析维度和输出格式。

### 调整技术指标参数

在 `intraday_indicators.py` 中修改相关函数的默认参数，例如：

```python
# 修改MACD参数
calculate_macd(data, fast=12, slow=26, signal=9)

# 修改RSI周期
calculate_rsi(data, period=14)
```

## ⚠️ 注意事项

1. **交易时间检查**：系统会检查当前是否在交易时间内（09:30-11:30, 13:00-15:00），非交易时间会给出警告。

2. **API频率限制**：请注意akshare和大模型API的调用频率限制，批量分析时系统会自动添加延时。

3. **数据准确性**：实时数据可能存在延迟，请以实际交易软件为准。

4. **仅供参考**：大模型的分析建议仅供参考，不构成投资建议，请结合自身情况谨慎决策。

5. **T+1制度**：系统分析时会考虑A股的T+1交易制度。

6. **API密钥安全**：请妥善保管 `keys.json` 文件，不要上传到公开代码仓库。

## 🛠️ 故障排除

### 问题1：无法获取实时数据

**可能原因：**
- 网络连接问题
- akshare接口临时不可用
- 股票代码输入错误

**解决方法：**
- 检查网络连接
- 稍后重试
- 确认股票代码格式正确（不需要加市场前缀）

### 问题2：大模型API调用失败

**可能原因：**
- API密钥错误或已过期
- API余额不足
- 网络问题

**解决方法：**
- 检查 `keys.json` 中的API密钥是否正确
- 登录API提供商网站查看余额和使用情况
- 检查网络连接和防火墙设置

### 问题3：提示词模板未找到

**解决方法：**
系统会自动使用内置的默认模板，也可以手动创建 `a_stock_trading_prompt_template.txt` 文件。

## 📞 技术支持

如遇到问题或有改进建议，请查看代码注释或修改相关模块。

## 📜 免责声明

本系统仅用于技术学习和研究目的，不构成任何投资建议。股市有风险，投资需谨慎。使用本系统产生的任何投资决策及其结果，均由使用者自行承担。

## 🎯 未来计划

- [ ] 添加更多技术指标
- [ ] 支持分时图可视化
- [ ] 添加历史回测功能
- [ ] 支持自定义交易策略
- [ ] 添加风险评估模型
- [ ] 支持更多大模型提供商

---

**版本**: v1.0  
**更新日期**: 2025-10-24  
**适用市场**: 中国A股

