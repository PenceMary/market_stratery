# äº¤æ˜“æ—¥åˆ¤æ–­ä¼˜åŒ–è¯´æ˜

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Š:
```
âŒ è·å–åˆ†æ—¶æ•°æ®å¤±è´¥: 'ticktime'
```

**æ ¹æœ¬åŸå› **: åœ¨éäº¤æ˜“æ—¥(å¦‚å‘¨æœ«ã€èŠ‚å‡æ—¥)è¿è¡Œç¨‹åºæ—¶,`get_today_intraday_data()` æ–¹æ³•ä¼šå°è¯•è·å–å½“å¤©çš„åˆ†æ—¶æ•°æ®,ä½†ç”±äºä¸æ˜¯äº¤æ˜“æ—¥,APIè¿”å›ç©ºDataFrame,å¯¼è‡´åç»­å¤„ç†'ticktime'å­—æ®µæ—¶å‡ºé”™ã€‚

## ğŸ¯ ç”¨æˆ·å»ºè®®

å‚è€ƒ `anaByQwen2.py` ä¸­çš„äº¤æ˜“æ—¥åˆ¤æ–­é€»è¾‘,å¢åŠ äº¤æ˜“æ—¥åˆ¤æ–­åŠŸèƒ½,é¿å…åœ¨éäº¤æ˜“æ—¥å°è¯•è·å–æ•°æ®å¯¼è‡´æŠ¥é”™ã€‚

## âœ… å®æ–½çš„ä¼˜åŒ–

### 1. æ–°å¢äº¤æ˜“æ—¥åˆ¤æ–­æ ¸å¿ƒåŠŸèƒ½

åœ¨ `IntradayDataFetcher` ç±»ä¸­æ·»åŠ äº†3ä¸ªæ ¸å¿ƒæ–¹æ³•:

#### æ–¹æ³•1: `_get_trading_calendar()`
```python
def _get_trading_calendar(self):
    """è·å–äº¤æ˜“æ—¥å†(å¸¦ç¼“å­˜)"""
    - ä½¿ç”¨ ak.tool_trade_date_hist_sina() è·å–äº¤æ˜“æ—¥å†
    - ç¼“å­˜åˆ°å®ä¾‹å˜é‡,é¿å…é‡å¤è¯·æ±‚
    - æå‡æ€§èƒ½
```

#### æ–¹æ³•2: `is_trading_day(date_str)`
```python
def is_trading_day(self, date_str: str) -> bool:
    """åˆ¤æ–­æŒ‡å®šæ—¥æœŸæ˜¯å¦ä¸ºäº¤æ˜“æ—¥"""
    - è¾“å…¥: æ—¥æœŸå­—ç¬¦ä¸² (æ ¼å¼: YYYYMMDD)
    - è¾“å‡º: True=äº¤æ˜“æ—¥, False=éäº¤æ˜“æ—¥
    - ç”¨é€”: åœ¨è·å–æ•°æ®å‰å…ˆåˆ¤æ–­
```

#### æ–¹æ³•3: `get_latest_trading_day(before_date)`
```python
def get_latest_trading_day(self, before_date: str = None) -> str:
    """è·å–æŒ‡å®šæ—¥æœŸä¹‹å‰(å«å½“å¤©)çš„æœ€è¿‘äº¤æ˜“æ—¥"""
    - è¾“å…¥: æ—¥æœŸå­—ç¬¦ä¸²,Noneè¡¨ç¤ºä»Šå¤©
    - è¾“å‡º: æœ€è¿‘äº¤æ˜“æ—¥ (æ ¼å¼: YYYYMMDD)
    - ç”¨é€”: å½“ä»Šå¤©ä¸æ˜¯äº¤æ˜“æ—¥æ—¶,å‘ŠçŸ¥ç”¨æˆ·æœ€è¿‘äº¤æ˜“æ—¥
```

---

### 2. ä¼˜åŒ– `get_today_intraday_data()` æ–¹æ³•

**ä¿®æ”¹å‰**:
```python
def get_today_intraday_data(self, stock_code: str):
    today = datetime.now().strftime('%Y%m%d')
    df = ak.stock_intraday_sina(symbol=symbol, date=today)
    # ç›´æ¥å¤„ç†,å¯èƒ½å‡ºé”™
```

**ä¿®æ”¹å**:
```python
def get_today_intraday_data(self, stock_code: str):
    today = datetime.now().strftime('%Y%m%d')
    
    # âœ… å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºäº¤æ˜“æ—¥
    if not self.is_trading_day(today):
        latest_trading_day = self.get_latest_trading_day(today)
        print(f"âš ï¸ ä»Šå¤©({today})ä¸æ˜¯äº¤æ˜“æ—¥,æœ€è¿‘çš„äº¤æ˜“æ—¥æ˜¯: {latest_trading_day}")
        print(f"âš ï¸ ä»Šæ—¥æ— åˆ†æ—¶æ•°æ®(éäº¤æ˜“æ—¥)")
        return pd.DataFrame()
    
    # æ˜¯äº¤æ˜“æ—¥æ‰ç»§ç»­è·å–æ•°æ®
    df = ak.stock_intraday_sina(symbol=symbol, date=today)
    ...
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… é¿å…æ— æ•ˆAPIè¯·æ±‚
- âœ… å‹å¥½çš„é”™è¯¯æç¤º
- âœ… å‘ŠçŸ¥ç”¨æˆ·æœ€è¿‘äº¤æ˜“æ—¥
- âœ… ä¸ä¼šå› ä¸º'ticktime'å­—æ®µä¸å­˜åœ¨è€ŒæŠ¥é”™

---

### 3. ä¼˜åŒ– `_get_trading_dates()` æ–¹æ³•

**ä¿®æ”¹å‰**:
```python
def _get_trading_dates(self, start_date, end_date):
    calendar = ak.tool_trade_date_hist_sina()  # æ¯æ¬¡éƒ½é‡æ–°è·å–
    ...
```

**ä¿®æ”¹å**:
```python
def _get_trading_dates(self, start_date, end_date):
    calendar = self._get_trading_calendar()  # ä½¿ç”¨ç¼“å­˜
    if calendar.empty:
        return []
    ...
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… ä½¿ç”¨ç¼“å­˜,å‡å°‘APIè°ƒç”¨
- âœ… æå‡æ€§èƒ½
- âœ… å¢åŠ ç©ºå€¼æ£€æŸ¥,æ›´å¥å£®

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰ (éäº¤æ˜“æ—¥è¿è¡Œ)

```
ğŸ“ˆ è·å– 002517 ä»Šæ—¥åˆ†æ—¶æ•°æ®...
âŒ è·å–åˆ†æ—¶æ•°æ®å¤±è´¥: 'ticktime'
```
- âŒ æŠ¥é”™ä¿¡æ¯ä¸å‹å¥½
- âŒ ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› 
- âŒ ç¨‹åºä¸­æ–­

### ä¿®æ”¹å (éäº¤æ˜“æ—¥è¿è¡Œ)

```
ğŸ“ˆ è·å– 002517 ä»Šæ—¥åˆ†æ—¶æ•°æ®...
âš ï¸ ä»Šå¤©(20251025)ä¸æ˜¯äº¤æ˜“æ—¥,æœ€è¿‘çš„äº¤æ˜“æ—¥æ˜¯: 20251024
âš ï¸ ä»Šæ—¥æ— åˆ†æ—¶æ•°æ®(éäº¤æ˜“æ—¥)
```
- âœ… æ¸…æ™°çš„æç¤ºä¿¡æ¯
- âœ… å‘ŠçŸ¥ç”¨æˆ·åŸå› 
- âœ… æä¾›æœ€è¿‘äº¤æ˜“æ—¥ä¿¡æ¯
- âœ… ç¨‹åºä¼˜é›…é™çº§,ç»§ç»­è¿è¡Œ

---

## ğŸ¯ åº”ç”¨åœºæ™¯

### åœºæ™¯1: å‘¨æœ«è¿è¡Œç¨‹åº
```bash
# å‘¨å…­/å‘¨æ—¥è¿è¡Œ
$ python intraday_trading_main.py 002517

âš ï¸ ä»Šå¤©(20251026)ä¸æ˜¯äº¤æ˜“æ—¥,æœ€è¿‘çš„äº¤æ˜“æ—¥æ˜¯: 20251024
âš ï¸ ä»Šæ—¥æ— åˆ†æ—¶æ•°æ®(éäº¤æ˜“æ—¥)
âœ… å†å²åˆ†æ—¶æ•°æ®è·å–å®Œæˆï¼Œå…± 2714 æ¡è®°å½•  â† å†å²æ•°æ®ä»å¯è·å–
```

### åœºæ™¯2: èŠ‚å‡æ—¥è¿è¡Œ
```bash
# å›½åº†å‡æœŸè¿è¡Œ
$ python intraday_trading_main.py 002517

âš ï¸ ä»Šå¤©(20251001)ä¸æ˜¯äº¤æ˜“æ—¥,æœ€è¿‘çš„äº¤æ˜“æ—¥æ˜¯: 20240930
âš ï¸ ä»Šæ—¥æ— åˆ†æ—¶æ•°æ®(éäº¤æ˜“æ—¥)
âœ… å†å²åˆ†æ—¶æ•°æ®è·å–å®Œæˆï¼Œå…± XXXX æ¡è®°å½•
```

### åœºæ™¯3: äº¤æ˜“æ—¥è¿è¡Œ
```bash
# äº¤æ˜“æ—¥è¿è¡Œ
$ python intraday_trading_main.py 002517

ğŸ“ˆ è·å– 002517 ä»Šæ—¥åˆ†æ—¶æ•°æ®...
âœ… åˆ†æ—¶æ•°æ®è·å–æˆåŠŸï¼Œå…± XXX æ¡è®°å½•  â† æ­£å¸¸è·å–
```

---

## ğŸ”§ æµ‹è¯•å·¥å…·

æä¾›äº†æµ‹è¯•è„šæœ¬ `test_trading_day.py`:

```bash
python test_trading_day.py
```

**æµ‹è¯•å†…å®¹**:
1. åˆ¤æ–­ä»Šå¤©æ˜¯å¦ä¸ºäº¤æ˜“æ—¥
2. è·å–æœ€è¿‘çš„äº¤æ˜“æ—¥
3. æµ‹è¯•å¤šä¸ªç‰¹å®šæ—¥æœŸ
4. æµ‹è¯•è·å–ä»Šæ—¥åˆ†æ—¶æ•°æ®(è‡ªåŠ¨åˆ¤æ–­äº¤æ˜“æ—¥)

---

## ğŸ“š å‚è€ƒå®ç°

æœ¬æ¬¡ä¼˜åŒ–å‚è€ƒäº† `anaByQwen2.py` ä¸­çš„ä»¥ä¸‹å‡½æ•°:

1. **`get_trading_dates(start_date, end_date)`**
   - è·å–æŒ‡å®šèŒƒå›´å†…çš„äº¤æ˜“æ—¥åˆ—è¡¨
   - ä½¿ç”¨ `ak.tool_trade_date_hist_sina()` è·å–äº¤æ˜“æ—¥å†

2. **`get_kline_date_range(kline_days, end_date)`**
   - åŸºäºäº¤æ˜“æ—¥è®¡ç®—Kçº¿æ•°æ®èŒƒå›´
   - ç¡®ä¿åªè·å–æœ‰æ•ˆçš„äº¤æ˜“æ—¥æ•°æ®

3. **`get_intraday_date_range(days_before_today, end_date)`**
   - åŸºäºäº¤æ˜“æ—¥è®¡ç®—åˆ†æ—¶æ•°æ®èŒƒå›´
   - é¿å…åŒ…å«éäº¤æ˜“æ—¥

---

## âœ… æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›
1. âœ… æ·»åŠ äº¤æ˜“æ—¥åˆ¤æ–­åŠŸèƒ½
2. âœ… ä¼˜åŒ–æ•°æ®è·å–é€»è¾‘
3. âœ… æå‡ç”¨æˆ·ä½“éªŒ
4. âœ… å¢å¼ºç¨‹åºå¥å£®æ€§

### ç”¨æˆ·æ”¶ç›Š
- ğŸ¯ **æ— è¯¯æ“ä½œ**: éäº¤æ˜“æ—¥è¿è¡Œä¸ä¼šæŠ¥é”™
- ğŸ“Š **æ¸…æ™°æç¤º**: æ˜ç¡®å‘ŠçŸ¥ä¸ºä½•æ— ä»Šæ—¥æ•°æ®
- âš¡ **æ€§èƒ½æå‡**: ä½¿ç”¨ç¼“å­˜å‡å°‘APIè°ƒç”¨
- ğŸ’ª **æ›´å¥å£®**: å¼‚å¸¸æƒ…å†µä¼˜é›…é™çº§

### æŠ€æœ¯äº®ç‚¹
- ğŸ“¦ **ç¼“å­˜æœºåˆ¶**: äº¤æ˜“æ—¥å†åªè·å–ä¸€æ¬¡
- ğŸ”„ **å¤ç”¨ä»£ç **: å¤šä¸ªæ–¹æ³•å…±äº«äº¤æ˜“æ—¥å†
- ğŸ›¡ï¸ **é˜²å¾¡ç¼–ç¨‹**: å®Œå–„çš„å¼‚å¸¸å¤„ç†
- ğŸ“ **å‹å¥½æç¤º**: è¯¦ç»†çš„ç”¨æˆ·åé¦ˆ

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2025-10-25  
**ç‰ˆæœ¬**: v2.2 (äº¤æ˜“æ—¥åˆ¤æ–­ä¼˜åŒ–ç‰ˆ)  
**å‚è€ƒæ–‡ä»¶**: `anaByQwen2.py`

